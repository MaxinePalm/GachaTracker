@model IEnumerable<GachaTracker.Models.ZZZCharacter>

@{
    ViewData["Title"] = "Zenless Zone Zero Tracker";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal {
            display: none;
        }

            .modal.active {
                display: flex;
            }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 text-white">
    @Html.AntiForgeryToken()

    <div class="max-w-7xl mx-auto p-8">
        <div class="flex items-center justify-between mb-8">
            <a href="/" class="flex items-center gap-2 text-purple-200 hover:text-purple-100 transition-all">
                <i data-lucide="home" class="w-5 h-5"></i>
                <span>All Games</span>
            </a>
            <div class="flex gap-2">
                <a href="/Genshin/Index" class="px-4 py-2 bg-white/10 hover:bg-white/20 border-2 border-white/20 rounded-lg transition-all">Genshin</a>
                <a href="/StarRail/Index" class="px-4 py-2 bg-white/10 hover:bg-white/20 border-2 border-white/20 rounded-lg transition-all">Star Rail</a>
                <a href="/ZZZ/Index" class="px-4 py-2 bg-cyan-500/30 border-2 border-cyan-400 rounded-lg font-semibold">ZZZ</a>
                <a href="/Wuthering/Index" class="px-4 py-2 bg-white/10 hover:bg-white/20 border-2 border-white/20 rounded-lg transition-all">Wuthering</a>
            </div>
        </div>

        <div class="text-center mb-12">
            <h1 class="text-6xl font-bold mb-4 bg-gradient-to-r from-cyan-300 via-blue-300 to-purple-300 bg-clip-text text-transparent">
                Zenless Zone Zero Agents
            </h1>
            <p class="text-xl text-purple-200">Track your Agents of New Eridu</p>
        </div>

        <div class="flex justify-between items-center mb-8 gap-4 flex-wrap">
            <div class="flex gap-2 flex-wrap">
                <button onclick="filterFaction('all')" class="filter-btn px-4 py-2 rounded-lg transition-all bg-purple-600 shadow-lg" data-faction="all">All</button>
                <button onclick="filterFaction('Attack')" class="filter-btn px-4 py-2 rounded-lg bg-red-500/20 hover:bg-red-500/40 border border-red-400/50" data-faction="Attack">Attack</button>
                <button onclick="filterFaction('Stun')" class="filter-btn px-4 py-2 rounded-lg bg-yellow-500/20 hover:bg-yellow-500/40 border border-yellow-400/50" data-faction="Stun">Stun</button>
                <button onclick="filterFaction('Support')" class="filter-btn px-4 py-2 rounded-lg bg-green-500/20 hover:bg-green-500/40 border border-green-400/50" data-faction="Support">Support</button>
                <button onclick="filterFaction('Defense')" class="filter-btn px-4 py-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/40 border border-blue-400/50" data-faction="Defense">Defense</button>
                <button onclick="filterFaction('Anomaly')" class="filter-btn px-4 py-2 rounded-lg bg-purple-500/20 hover:bg-purple-500/40 border border-purple-400/50" data-faction="Anomaly">Anomaly</button>
                <button onclick="filterFaction('Rupture')" class="filter-btn px-4 py-2 rounded-lg bg-orange-500/20 hover:bg-orange-500/40 border border-orange-400/50" data-faction="Rupture">Rupture</button>
            </div>
            <button onclick="openModal()" class="flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-600 px-6 py-3 rounded-lg hover:shadow-xl hover:shadow-cyan-500/50 transition-all transform hover:scale-105">
                <i data-lucide="plus" class="w-5 h-5"></i>
                Add Agent
            </button>
        </div>

        <div id="characterGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        <div id="emptyState" class="text-center py-20 hidden">
            <p class="text-2xl text-purple-300">No agents yet. Add your first Agent!</p>
        </div>
    </div>

    <div id="characterModal" class="modal fixed inset-0 bg-black/70 backdrop-blur-sm items-center justify-center z-50 p-4">
        <div class="bg-gradient-to-br from-indigo-900 to-purple-900 rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto border-2 border-cyan-400/30 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modalTitle" class="text-3xl font-bold">Add New Agent</h2>
                <button onclick="closeModal()" class="p-2 hover:bg-white/10 rounded-lg transition-all">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <form id="characterForm" class="space-y-4">
                <input type="hidden" id="characterId" value="0">

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-purple-200 mb-2">Agent Name</label>
                        <input type="text" id="name" required class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                    </div>
                    <div>
                        <label class="block text-sm text-purple-200 mb-2">Element</label>
                        <select id="element" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                            <option>Physical</option>
                            <option>Fire</option>
                            <option>Ice</option>
                            <option>Electric</option>
                            <option>Ether</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-purple-200 mb-2">Faction</label>
                        <select id="faction" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                            <option>Attack</option>
                            <option>Stun</option>
                            <option>Support</option>
                            <option>Defense</option>
                            <option>Anomaly</option>
                            <option>Rupture</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-purple-200 mb-2">Rank</label>
                        <select id="rank" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                            <option value="A">A Rank</option>
                            <option value="S" selected>S Rank</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm text-purple-200 mb-2">Agent Level (Max 60)</label>
                    <input type="number" id="currentLevel" value="1" min="1" max="60" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                </div>

                <div class="border-t border-white/20 pt-4">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="zap" class="w-5 h-5"></i> W-Engine
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-purple-200 mb-2">W-Engine Name</label>
                            <input type="text" id="wEngineName" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                        </div>
                        <div>
                            <label class="block text-sm text-purple-200 mb-2">Level (Max 60)</label>
                            <input type="number" id="wEngineLevel" value="1" min="1" max="60" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                        </div>
                    </div>
                </div>

                <div class="border-t border-white/20 pt-4">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="swords" class="w-5 h-5"></i> Skills (Max 12)
                    </h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm text-purple-200 mb-2">Basic Attack</label>
                            <input type="number" id="skillBasicAttack" value="1" min="1" max="12" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                        </div>
                        <div>
                            <label class="block text-sm text-purple-200 mb-2">Dodge</label>
                            <input type="number" id="skillDodge" value="1" min="1" max="12" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                        </div>
                        <div>
                            <label class="block text-sm text-purple-200 mb-2">Assist</label>
                            <input type="number" id="skillAssist" value="1" min="1" max="12" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                        </div>
                        <div>
                            <label class="block text-sm text-purple-200 mb-2">Special Attack</label>
                            <input type="number" id="skillSpecialAttack" value="1" min="1" max="12" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                        </div>
                        <div>
                            <label class="block text-sm text-purple-200 mb-2">Chain Attack</label>
                            <input type="number" id="skillChainAttack" value="1" min="1" max="12" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                        </div>
                        <div>
                            <label class="block text-sm text-purple-200 mb-2">Talent (Max 6)</label>
                            <input type="number" id="skillTalent" value="1" min="1" max="6" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                        </div>
                    </div>
                </div>

                <div class="border-t border-white/20 pt-4">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="cpu" class="w-5 h-5"></i> Core Skills
                    </h3>
                    <div>
                        <label class="block text-sm text-purple-200 mb-2">Core Skills Completed (0-6)</label>
                        <input type="number" id="coreSkillsCompleted" value="0" min="0" max="6" class="w-full bg-black/30 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:border-cyan-400 transition-all text-white">
                    </div>
                </div>

                <div class="flex gap-4 pt-6">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 py-3 rounded-lg hover:shadow-xl hover:shadow-green-500/50 transition-all transform hover:scale-105 flex items-center justify-center gap-2 font-semibold">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span id="saveButtonText">Save Agent</span>
                    </button>
                    <button type="button" onclick="closeModal()" class="flex-1 bg-white/10 py-3 rounded-lg hover:bg-white/20 transition-all">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let characters = [];
        let currentFilter = 'all';
        let editingId = 0;

        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            loadCharacters();
        });

        async function loadCharacters() {
            try {
                const response = await fetch('/ZZZ/GetAll');
                characters = await response.json();
                renderCharacters();
            } catch (error) {
                console.error('Error loading characters:', error);
            }
        }

        function renderCharacters() {
            const grid = document.getElementById('characterGrid');
            const emptyState = document.getElementById('emptyState');
            const filtered = currentFilter === 'all' ? characters : characters.filter(c => c.faction === currentFilter);

            if (filtered.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            grid.innerHTML = filtered.map(char => `
                <div class="bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-lg rounded-xl p-6 border border-white/20 hover:border-cyan-400/50 transition-all hover:shadow-2xl hover:shadow-cyan-500/30 transform hover:-translate-y-1">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-2xl font-bold mb-1">${char.name}</h3>
                            <div class="flex items-center gap-2 text-sm text-purple-200">
                                <span>${char.element}</span><span>•</span><span>${char.faction}</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editCharacter(${char.id})" class="p-2 bg-blue-500/20 hover:bg-blue-500/40 rounded-lg transition-all">
                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteCharacter(${char.id})" class="p-2 bg-red-500/20 hover:bg-red-500/40 rounded-lg transition-all">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <span class="px-3 py-1 ${char.rank === 'S' ? 'bg-yellow-500/30 text-yellow-300' : 'bg-purple-500/30 text-purple-300'} rounded-full text-sm font-bold">${char.rank} Rank</span>
                    </div>
                    <div class="mb-3">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-purple-200">Level</span>
                            <span class="font-semibold">${char.currentLevel}/60</span>
                        </div>
                        <div class="h-2 bg-black/30 rounded-full overflow-hidden">
                            <div class="${getProgressColor(char.currentLevel, 60)} h-full" style="width: ${(char.currentLevel / 60) * 100}%"></div>
                        </div>
                    </div>
                    ${char.wEngineName ? `
                    <div class="mb-3">
                        <div class="flex items-center gap-2 text-sm mb-1">
                            <i data-lucide="zap" class="w-3.5 h-3.5"></i>
                            <span class="text-purple-200">${char.wEngineName}</span>
                        </div>
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-purple-300">Lv ${char.wEngineLevel}/60</span>
                        </div>
                        <div class="h-2 bg-black/30 rounded-full overflow-hidden">
                            <div class="${getProgressColor(char.wEngineLevel, 60)} h-full" style="width: ${(char.wEngineLevel / 60) * 100}%"></div>
                        </div>
                    </div>` : ''}
                    <div class="grid grid-cols-3 gap-2 mb-3">
                        <div class="bg-black/20 rounded p-2 text-center">
                            <div class="text-xs text-purple-200">Basic</div>
                            <div class="font-bold">${char.skillBasicAttack}/12</div>
                        </div>
                        <div class="bg-black/20 rounded p-2 text-center">
                            <div class="text-xs text-purple-200">Dodge</div>
                            <div class="font-bold">${char.skillDodge}/12</div>
                        </div>
                        <div class="bg-black/20 rounded p-2 text-center">
                            <div class="text-xs text-purple-200">Assist</div>
                            <div class="font-bold">${char.skillAssist}/12</div>
                        </div>
                        <div class="bg-black/20 rounded p-2 text-center">
                            <div class="text-xs text-purple-200">Special</div>
                            <div class="font-bold">${char.skillSpecialAttack}/12</div>
                        </div>
                        <div class="bg-black/20 rounded p-2 text-center">
                            <div class="text-xs text-purple-200">Chain</div>
                            <div class="font-bold">${char.skillChainAttack}/12</div>
                        </div>
                        <div class="bg-black/20 rounded p-2 text-center">
                            <div class="text-xs text-purple-200">Talent</div>
                            <div class="font-bold">${char.skillTalent}/6</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-sm bg-black/20 rounded p-2">
                        <div class="flex items-center gap-2">
                            <i data-lucide="cpu" class="w-3.5 h-3.5 text-cyan-400"></i>
                            <span class="text-purple-200">Core Skills</span>
                        </div>
                        <span class="font-bold">${char.coreSkillsCompleted}/6</span>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function getProgressColor(current, max) {
            const percent = (current / max) * 100;
            if (percent === 100) return 'bg-gradient-to-r from-green-500 to-emerald-500';
            if (percent >= 75) return 'bg-gradient-to-r from-blue-500 to-cyan-500';
            if (percent >= 50) return 'bg-gradient-to-r from-yellow-500 to-orange-500';
            return 'bg-gradient-to-r from-red-500 to-pink-500';
        }

        function filterFaction(faction) {
            currentFilter = faction;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.faction === faction) {
                    btn.classList.add('bg-purple-600', 'shadow-lg');
                } else {
                    btn.classList.remove('bg-purple-600', 'shadow-lg');
                }
            });
            renderCharacters();
        }

        function openModal() {
            editingId = 0;
            document.getElementById('modalTitle').textContent = 'Add New Agent';
            document.getElementById('saveButtonText').textContent = 'Save Agent';
            document.getElementById('characterForm').reset();
            document.getElementById('characterModal').classList.add('active');
            lucide.createIcons();
        }

        function closeModal() {
            document.getElementById('characterModal').classList.remove('active');
        }

        function editCharacter(id) {
            const char = characters.find(c => c.id === id);
            if (!char) return;
            editingId = id;
            document.getElementById('modalTitle').textContent = 'Edit Agent';
            document.getElementById('saveButtonText').textContent = 'Update Agent';
            document.getElementById('characterId').value = char.id;
            document.getElementById('name').value = char.name;
            document.getElementById('element').value = char.element;
            document.getElementById('faction').value = char.faction;
            document.getElementById('rank').value = char.rank;
            document.getElementById('currentLevel').value = char.currentLevel;
            document.getElementById('wEngineName').value = char.wEngineName || '';
            document.getElementById('wEngineLevel').value = char.wEngineLevel;
            document.getElementById('skillBasicAttack').value = char.skillBasicAttack;
            document.getElementById('skillDodge').value = char.skillDodge;
            document.getElementById('skillAssist').value = char.skillAssist;
            document.getElementById('skillSpecialAttack').value = char.skillSpecialAttack;
            document.getElementById('skillChainAttack').value = char.skillChainAttack;
            document.getElementById('skillTalent').value = char.skillTalent;
            document.getElementById('coreSkillsCompleted').value = char.coreSkillsCompleted;
            document.getElementById('characterModal').classList.add('active');
            lucide.createIcons();
        }

        async function deleteCharacter(id) {
            if (!confirm('Are you sure you want to delete this agent?')) return;
            const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
            const formData = new FormData();
            formData.append('__RequestVerificationToken', token);
            try {
                const response = await fetch(`/ZZZ/Delete/${id}`, { method: 'POST', body: formData });
                if (response.ok) await loadCharacters();
            } catch (error) {
                console.error('Error deleting character:', error);
            }
        }

        document.getElementById('characterForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const character = {
                id: editingId,
                name: document.getElementById('name').value,
                element: document.getElementById('element').value,
                faction: document.getElementById('faction').value,
                rank: document.getElementById('rank').value,
                currentLevel: parseInt(document.getElementById('currentLevel').value),
                wEngineName: document.getElementById('wEngineName').value,
                wEngineLevel: parseInt(document.getElementById('wEngineLevel').value),
                skillBasicAttack: parseInt(document.getElementById('skillBasicAttack').value),
                skillDodge: parseInt(document.getElementById('skillDodge').value),
                skillAssist: parseInt(document.getElementById('skillAssist').value),
                skillSpecialAttack: parseInt(document.getElementById('skillSpecialAttack').value),
                skillChainAttack: parseInt(document.getElementById('skillChainAttack').value),
                skillTalent: parseInt(document.getElementById('skillTalent').value),
                coreSkillsCompleted: parseInt(document.getElementById('coreSkillsCompleted').value)
            };

            try {
                const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
                const formData = new FormData();
                Object.keys(character).forEach(key => formData.append(key, character[key]));
                formData.append('__RequestVerificationToken', token);

                const url = editingId > 0 ? `/ZZZ/Edit/${editingId}` : '/ZZZ/Create';
                const response = await fetch(url, { method: 'POST', body: formData });
                if (response.ok) {
                    await loadCharacters();
                    closeModal();
                }
            } catch (error) {
                console.error('Error saving character:', error);
            }
        });
    </script>
</body>
</html>